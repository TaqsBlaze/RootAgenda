// @ts-nocheck
document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("currentYear").textContent=(new Date).getFullYear();const e=document.getElementById("generateAgendaBtn"),t=document.getElementById("meetingTopic"),n=document.getElementById("desiredOutcomes"),a=document.getElementById("generatedAgenda"),s=document.getElementById("summarizeNotesBtn"),o=document.getElementById("meetingNotes"),r=document.getElementById("generatedSummary"),i=document.getElementById("tabAgendaBtn"),l=document.getElementById("tabSummaryBtn"),d=document.getElementById("tabAgenda"),c=document.getElementById("tabSummary"),m="https://api.mafaro.co.zw/api/agenda",g="agenda-tokens",p="summary-tokens",u="last-token-reset-date";function y(e){const t=localStorage.getItem(e);return t?parseInt(t,10):0}function h(e,t){localStorage.setItem(e,t.toString())}function v(e){let t=y(e);return t>0&&(t-=1,h(e,t)),t}function x(){const e=document.getElementById("agendaTokensDisplay"),t=document.getElementById("summaryTokensDisplay");e&&(e.innerHTML=`\n                <svg class="icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>\n                </svg>\n                Agenda Tokens: <span class="font-bold text-violet-400">${y(g)}</span>`),t&&(t.innerHTML=`\n                <svg class="icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.747 0-3.332.477-4.5 1.253"></path>\n                </svg>\n                Summary Tokens: <span class="font-bold text-violet-400">${y(p)}</span>`)}!function(){const e=(new Date).toDateString();localStorage.getItem(u)!==e?(h(g,2),h(p,1),localStorage.setItem(u,e),console.log("Tokens reset for the day.")):console.log("Tokens already reset or initialized for today."),null===localStorage.getItem(g)&&h(g,2),null===localStorage.getItem(p)&&h(p,1)}(),window.openTab=e=>{i.classList.remove("active"),l.classList.remove("active"),d.classList.remove("active"),c.classList.remove("active"),"agenda"===e?(i.classList.add("active"),d.classList.add("active")):"summary"===e&&(l.classList.add("active"),c.classList.add("active")),x()},openTab("agenda"),x(),e.addEventListener("click",(async()=>{const e=t.value.trim(),s=n.value.trim();if(!e||!s)return void(a.innerHTML='<p class="text-red-400">Please enter a meeting topic and desired outcomes.</p>');if(y(g)<=0)a.innerHTML='<p class="text-red-400">You have no agenda generation tokens left for today. Please try again tomorrow.</p>';else{a.innerHTML='<p class="text-indigo-300 animate-pulse">Generating agenda...</p>';try{[].push({topic:`${e}`,outcomes:`${s}`,type:"agenda"});const t={contents:{topic:`${e}`,outcomes:`${s}`,type:"agenda"}},n=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await n.json();if(n.ok&&o.candidates&&o.candidates.length>0&&o.candidates[0].content&&o.candidates[0].content.parts&&o.candidates[0].content.parts.length>0){v(g),x();let t=o.candidates[0].content.parts[0].text;t=t.replace(/```html\n|\n```/g,"").trim(),t.includes("<ol>")||t.includes("<ul>")||(t=t.split("\n").filter((e=>""!==e.trim())).map((e=>e.match(/^\s*(\d+\.|\-|\*)\s/)?`<li>${e.replace(/^\s*(\d+\.|\-|\*)\s*/,"")}</li>`:`<p>${e}</p>`)).join(""),t.includes("<li>")&&(t=`<ol class="list-decimal list-inside space-y-2">${t}</ol>`));let n=`\n                    <h4 class="text-2xl font-semibold mb-3">Meeting Agenda: ${e}</h4>\n                    <p class="text-sm text-gray-400 mb-4">Date: ${(new Date).toLocaleDateString()}</p>\n                    ${t}\n                    <p class="mt-6 text-xs text-gray-500 text-right">Generated by RootAgenda AI</p>\n                `;a.innerHTML=n}else a.innerHTML=`<p class="text-red-400">Failed to generate agenda. Please try again. ${o.error?"Details: "+(o.error.details||o.error):""}</p>`,console.error("API Response Error:",o)}catch(e){console.error("Error generating agenda:",e),a.innerHTML='<p class="text-red-400">An error occurred while generating the agenda. Please try again.</p>'}}})),s.addEventListener("click",(async()=>{const e=o.value.trim();if(!e)return void(r.innerHTML='<p class="text-red-400">Please paste some meeting notes to summarize.</p>');if(y(p)<=0)r.innerHTML='<p class="text-red-400">You have no summary generation tokens left for today. Please try again tomorrow.</p>';else{r.innerHTML='<p class="text-indigo-300 animate-pulse">Summarizing notes...</p>';try{[].push({notes:`${e}`,type:"summery"});const t={contents:{notes:`${e}`,type:"summery"}},n=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json();if(n.ok&&a.candidates&&a.candidates.length>0&&a.candidates[0].content&&a.candidates[0].content.parts&&a.candidates[0].content.parts.length>0){v(p),x();let e=a.candidates[0].content.parts[0].text;e=e.replace(/```html\n|\n```/g,"").trim(),e.includes("<ul")||e.includes("<ol>")||(e=e.split("\n").filter((e=>""!==e.trim())).map((e=>e.match(/^\s*(\-|\*)\s/)?`<li>${e.replace(/^\s*(\-|\*)\s*/,"")}</li>`:`<p>${e}</p>`)).join(""),e.includes("<li>")&&(e=`<ul class="list-disc list-inside space-y-1">${e}</ul>`));let t=`\n                    <h4 class="text-2xl font-semibold mb-3">Meeting Summary:</h4>\n                    ${e}\n                    <p class="mt-6 text-xs text-gray-500 text-right">Generated by RootAgenda AI</p>\n                `;r.innerHTML=t}else r.innerHTML=`<p class="text-red-400">Failed to summarize notes. Please try again. ${a.error?"Details: "+(a.error.details||a.error):""}</p>`,console.error("API Response Error:",a)}catch(e){console.error("Error summarizing notes:",e),r.innerHTML='<p class="text-red-400">An error occurred while summarizing notes. Please try again.</p><p class="text-red-400">Error details: '+e.message+"</p>"}}}))}));