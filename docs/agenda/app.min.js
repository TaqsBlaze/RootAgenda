// @ts-nocheck
document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("currentYear").textContent=(new Date).getFullYear();const e=document.getElementById("generateAgendaBtn"),t=document.getElementById("meetingTopic"),n=document.getElementById("desiredOutcomes"),a=document.getElementById("generatedAgenda"),s=document.getElementById("printAgendaBtn"),r=document.getElementById("summarizeNotesBtn"),o=document.getElementById("meetingNotes"),i=document.getElementById("generatedSummary"),d=document.getElementById("printSummaryBtn"),l=document.getElementById("tabAgendaBtn"),c=document.getElementById("tabSummaryBtn"),m=document.getElementById("tabAgenda"),g=document.getElementById("tabSummary"),p="https://api.mafaro.co.zw/api/agenda",u="agenda-tokens",y="summary-tokens",h="last-token-reset-date";function v(e){const t=localStorage.getItem(e);return t?parseInt(t,10):0}function L(e,t){localStorage.setItem(e,t.toString())}function w(e){let t=v(e);return t>0&&(t-=1,L(e,t)),t}function k(){const e=document.getElementById("agendaTokensDisplay"),t=document.getElementById("summaryTokensDisplay");e&&(e.innerHTML=`\n                <svg class="icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>\n                </svg>\n                Agenda Tokens: <span class="font-bold text-violet-400">${v(u)}</span>`),t&&(t.innerHTML=`\n                <svg class="icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.747 0-3.332.477-4.5 1.253"></path>\n                </svg>\n                Summary Tokens: <span class="font-bold text-violet-400">${v(y)}</span>`)}function f(){s.classList.add("hidden"),d.classList.add("hidden")}function E(e,t){const n=e.innerHTML.trim();e===a?n&&'<p class="text-gray-400 italic">Your meeting agenda will appear here.</p>'!==n?t.classList.remove("hidden"):t.classList.add("hidden"):e===i&&(n&&'<p class="text-gray-400 italic">Your meeting summary will appear here.</p>'!==n?t.classList.remove("hidden"):t.classList.add("hidden"))}function x(e){const t=document.getElementById(e).innerHTML,n=(document.body.innerHTML,window.open("","","height=600,width=800"));n.document.write("<html><head><title>Print</title>"),n.document.write('<link href="https://cdn.tailwindcss.com" rel="stylesheet">'),n.document.write("<style>"),n.document.write("\n            body { font-family: 'Inter', sans-serif; margin: 0; padding: 1in; color: black; background-color: white; }\n            .prose-invert { color: black !important; }\n            h3, h4, p, li { color: black !important; }\n            .print-button { display: none !important; }\n            /* Basic styling for ordered/unordered lists for print */\n            ol, ul { margin-left: 1.5em; }\n            li { margin-bottom: 0.5em; }\n        "),n.document.write("</style>"),n.document.write("</head><body>"),n.document.write('<div id="printableArea">'),n.document.write(t),n.document.write("</div></body></html>"),n.document.close(),n.focus(),n.print(),n.close()}!function(){const e=(new Date).toDateString();localStorage.getItem(h)!==e?(L(u,2),L(y,1),localStorage.setItem(h,e),console.log("Tokens reset for the day.")):console.log("Tokens already reset or initialized for today."),null===localStorage.getItem(u)&&L(u,2),null===localStorage.getItem(y)&&L(y,1)}(),window.openTab=e=>{l.classList.remove("active"),c.classList.remove("active"),m.classList.remove("active"),g.classList.remove("active"),"agenda"===e?(l.classList.add("active"),m.classList.add("active")):"summary"===e&&(c.classList.add("active"),g.classList.add("active")),k(),f()},openTab("agenda"),k(),f();const T=async()=>{const e=t.value.trim(),r=n.value.trim();if(!e||!r)return a.innerHTML='<p class="text-red-400">Please enter a meeting topic and desired outcomes.</p>',void E(a,s);if(v(u)<=0)return a.innerHTML='<p class="text-red-400">You have no agenda generation tokens left for today. Please try again tomorrow.</p>',void E(a,s);a.innerHTML='<p class="text-indigo-300 animate-pulse">Generating agenda...</p>',E(a,s);try{[].push({topic:`${e}`,outcomes:`${r}`,type:"agenda"});const t={contents:{topic:`${e}`,outcomes:`${r}`,type:"agenda"}},n=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await n.json();if(n.ok&&o.candidates&&o.candidates.length>0&&o.candidates[0].content&&o.candidates[0].content.parts&&o.candidates[0].content.parts.length>0){w(u),k();let t=o.candidates[0].content.parts[0].text;t=t.replace(/```html\n|\n```/g,"").trim(),t.includes("<ol>")||t.includes("<ul>")||(t=t.split("\n").filter((e=>""!==e.trim())).map((e=>e.match(/^\s*(\d+\.|\-|\*)\s/)?`<li>${e.replace(/^\s*(\d+\.|\-|\*)\s*/,"")}</li>`:`<p>${e}</p>`)).join(""),t.includes("<li>")&&(t=`<ol class="list-decimal list-inside space-y-2">${t}</ol>`));let n=`\n                    <h4 class="text-2xl font-semibold mb-3">Meeting Agenda: ${e}</h4>\n                    <p class="text-sm text-gray-400 mb-4">Date: ${(new Date).toLocaleDateString()}</p>\n                    ${t}\n                    <p class="mt-6 text-xs text-gray-500 text-right">Generated by RootAgenda AI</p>\n                `;a.innerHTML=n,E(a,s)}else a.innerHTML=`<p class="text-red-400">Failed to generate agenda. Please try again. ${o.error?"Details: "+(o.error.details||o.error):""}</p>`,console.error("API Response Error:",o),E(a,s)}catch(e){console.error("Error generating agenda:",e),a.innerHTML='<p class="text-red-400">An error occurred while generating the agenda. Please try again.</p>',E(a,s)}};e.addEventListener("click",T),s.addEventListener("click",(()=>x("generatedAgenda")));const b=async()=>{const e=o.value.trim();if(!e)return i.innerHTML='<p class="text-red-400">Please paste some meeting notes to summarize.</p>',void E(i,d);if(v(y)<=0)return i.innerHTML='<p class="text-red-400">You have no summary generation tokens left for today. Please try again tomorrow.</p>',void E(i,d);i.innerHTML='<p class="text-indigo-300 animate-pulse">Summarizing notes...</p>',E(i,d);try{[].push({notes:`${e}`,type:"summery"});const t={contents:{notes:`${e}`,type:"summery"}},n=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json();if(n.ok&&a.candidates&&a.candidates.length>0&&a.candidates[0].content&&a.candidates[0].content.parts&&a.candidates[0].content.parts.length>0){w(y),k();let e=a.candidates[0].content.parts[0].text;e=e.replace(/```html\n|\n```/g,"").trim(),e.includes("<ul")||e.includes("<ol>")||(e=e.split("\n").filter((e=>""!==e.trim())).map((e=>e.match(/^\s*(\-|\*)\s/)?`<li>${e.replace(/^\s*(\-|\*)\s*/,"")}</li>`:`<p>${e}</p>`)).join(""),e.includes("<li>")&&(e=`<ul class="list-disc list-inside space-y-1">${e}</ul>`));let t=`\n                    <h4 class="text-2xl font-semibold mb-3">Meeting Summary:</h4>\n                    ${e}\n                    <p class="mt-6 text-xs text-gray-500 text-right">Generated by RootAgenda AI</p>\n                `;i.innerHTML=t,E(i,d)}else i.innerHTML=`<p class="text-red-400">Failed to summarize notes. Please try again. ${a.error?"Details: "+(a.error.details||a.error):""}</p>`,console.error("API Response Error:",a),E(i,d)}catch(e){console.error("Error summarizing notes:",e),i.innerHTML='<p class="text-red-400">An error occurred while summarizing notes. Please try again.</p><p class="text-red-400">Error details: '+e.message+"</p>",E(i,d)}};r.addEventListener("click",b),d.addEventListener("click",(()=>x("generatedSummary"))),e.removeEventListener("click",T),e.addEventListener("click",T),r.removeEventListener("click",b),r.addEventListener("click",b),s.removeEventListener("click",(()=>x("generatedAgenda"))),s.addEventListener("click",(()=>x("generatedAgenda"))),d.removeEventListener("click",(()=>x("generatedSummary"))),d.addEventListener("click",(()=>x("generatedSummary"))),l.removeEventListener("click",(()=>openTab("agenda"))),l.addEventListener("click",(()=>openTab("agenda"))),c.removeEventListener("click",(()=>openTab("summary"))),c.addEventListener("click",(()=>openTab("summary")))}));